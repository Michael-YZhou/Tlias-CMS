<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tlias.mapper.EmpMapper">
    <select id="list" resultType="com.tlias.pojo.Emp">
        SELECT e.*,
        d.name AS deptName
        FROM emp e
        LEFT JOIN dept d ON e.dept_id = d.id
        <where>
            <if test="name != null and name != ''">
                e.name LIKE CONCAT('%', #{name}, '%')
            </if>
            <if test="gender != null">
                AND e.gender = #{gender}
            </if>
            <if test="begin != null and end != null">
                AND e.entry_date BETWEEN #{begin} AND #{end}
            </if>
        </where>
        ORDER BY e.update_time DESC
    </select>

    <!--统计员工职位人数-->
    <!--case函数最后以end结尾-->
    <select id="countEmpJobData" resultType="java.util.Map">
        select (case
                    when job = 1 then '班主任'
                    when job = 2 then '讲师'
                    when job = 3 then '学工主管'
                    when job = 4 then '教研主管'
                    when job = 5 then '咨询师'
                    else '其他' end) as pos,
               count(*)              as num
        from emp
        group by job
        order by num
    </select>

    <!--统计员工性别人数-->
    <!--if（expr,val1,val2）如果表达式expr成立取val1，若expr不成立取val2-->
    <!--ifnull(expr,val1)如果表达式expr不为空取自身，为null取val1-->
    <select id="countEmpGenderData" resultType="java.util.Map">
        select
            if(gender = 1, '男性员工', '女性员工') as name,
            count(*) as value
        from emp group by gender
    </select>
</mapper>